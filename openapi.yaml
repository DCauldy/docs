openapi: 3.1.0
info:
  title: North Reports API
  description: |
    The North Reports API allows you to programmatically access and manage your North reports.

    Use this API to:
    - Create and update property reports
    - Manage comparable properties
    - Track showings and open houses
    - Import social media engagement data
    - Generate AI-powered summaries

    Perfect for integrations with Zapier, n8n, Make.com, or custom applications.
  version: 1.0.0
  contact:
    name: North Support
    url: https://northreports.com/support
  termsOfService: https://northreports.com/terms

servers:
  - url: https://api.northreports.com
    description: Production API

security:
  - BearerAuth: []

tags:
  - name: Users
    description: User and team information
  - name: Reports
    description: Create and manage North reports
  - name: Comparables
    description: Manage comparable properties
  - name: Showings
    description: Track showings and open houses
  - name: Social Media
    description: Import and track social media engagement
  - name: Webhooks
    description: Subscribe to real-time events

paths:
  /v1/users/me:
    get:
      operationId: getCurrentUser
      summary: Get current user
      description: |
        Returns information about the authenticated team, subscription, and API key.
        This is typically the first endpoint to call to verify your API key is working.
      tags:
        - Users
      responses:
        '200':
          description: Successfully retrieved user information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
              example:
                data:
                  team:
                    id: "550e8400-e29b-41d4-a716-446655440000"
                    name: "Acme Realty"
                    created_at: "2024-01-15T10:30:00Z"
                    member_count: 3
                    reports_count: 25
                  subscription:
                    plan: "professional"
                    status: "active"
                    api_usage:
                      calls_this_month: 150
                      resets_at: "2024-02-01T00:00:00Z"
                  api_key:
                    name: "Production Key"
                    prefix: "north_sk_live_abc12345"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

  /v1/reports:
    get:
      operationId: listReports
      summary: List all reports
      description: |
        Retrieves a paginated list of all reports in your team.
        Use query parameters to filter and paginate results.
      tags:
        - Reports
      parameters:
        - name: limit
          in: query
          description: Maximum number of reports to return
          schema:
            type: integer
            default: 50
            minimum: 1
            maximum: 100
        - name: offset
          in: query
          description: Number of reports to skip for pagination
          schema:
            type: integer
            default: 0
            minimum: 0
        - name: status
          in: query
          description: Filter by report status
          schema:
            type: string
            enum: [draft, published, all]
      responses:
        '200':
          description: Successfully retrieved reports
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReportsListResponse'
              example:
                data:
                  - id: "550e8400-e29b-41d4-a716-446655440000"
                    address: "123 Main Street"
                    city: "Austin"
                    state: "TX"
                    zip: "78701"
                    price: 450000
                    bedrooms: 3
                    bathrooms: 2
                    square_feet: 1850
                    is_published: true
                    views_count: 45
                    date_created: "2024-01-15T10:30:00Z"
                total: 25
                limit: 50
                offset: 0
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

    post:
      operationId: createReport
      summary: Create a new report
      description: |
        Creates a new North report with the provided property information.
        The report will be created as a draft by default.
      tags:
        - Reports
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateReportRequest'
            example:
              address: "456 Oak Avenue"
              city: "Austin"
              state: "TX"
              zip: "78704"
              price: 525000
              bedrooms: 4
              bathrooms: 2.5
              square_feet: 2200
              year_built: 2015
              property_type: "Single Family"
              description: "Beautiful home with modern updates"
              custom_agent_name: "Jane Doe"
      responses:
        '201':
          description: Report created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateReportResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

  /v1/reports/{reportId}:
    get:
      operationId: getReport
      summary: Get a specific report
      description: |
        Retrieves a single report with all its details including comparables, showings, and social media posts.
      tags:
        - Reports
      parameters:
        - name: reportId
          in: path
          required: true
          description: The report ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Successfully retrieved report
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/ReportFull'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

    patch:
      operationId: updateReport
      summary: Update a report
      description: |
        Updates an existing report. Only provided fields will be updated.
      tags:
        - Reports
      parameters:
        - name: reportId
          in: path
          required: true
          description: The report ID to update
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateReportRequest'
      responses:
        '200':
          description: Report updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdateReportResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

    delete:
      operationId: deleteReport
      summary: Delete a report
      description: |
        Permanently deletes a report and all associated data (comparables, showings, etc.).
        This action cannot be undone.
      tags:
        - Reports
      parameters:
        - name: reportId
          in: path
          required: true
          description: The report ID to delete
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Report deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

  /v1/showings:
    get:
      operationId: listShowings
      summary: List showings
      description: |
        Returns a list of showings across all reports, or filter by report_id.
      tags:
        - Showings
      parameters:
        - name: report_id
          in: query
          description: Filter showings by report ID
          schema:
            type: string
            format: uuid
        - name: limit
          in: query
          description: Maximum number of showings to return
          schema:
            type: integer
            default: 50
            minimum: 1
            maximum: 100
        - name: offset
          in: query
          description: Number of showings to skip
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: Successfully retrieved showings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ShowingsListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

    post:
      operationId: createShowing
      summary: Create a new showing
      description: |
        Creates a new showing or open house event for a report.
      tags:
        - Showings
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateShowingRequest'
      responses:
        '201':
          description: Showing created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateShowingResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

  /v1/showings/{showingId}:
    get:
      operationId: getShowing
      summary: Get a specific showing
      description: |
        Retrieves details for a single showing.
      tags:
        - Showings
      parameters:
        - name: showingId
          in: path
          required: true
          description: The showing ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Successfully retrieved showing
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Showing'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

    patch:
      operationId: updateShowing
      summary: Update a showing
      description: |
        Updates an existing showing. Only provided fields will be updated.
      tags:
        - Showings
      parameters:
        - name: showingId
          in: path
          required: true
          description: The showing ID to update
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateShowingRequest'
      responses:
        '200':
          description: Showing updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdateShowingResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

    delete:
      operationId: deleteShowing
      summary: Delete a showing
      description: |
        Permanently deletes a showing event.
      tags:
        - Showings
      parameters:
        - name: showingId
          in: path
          required: true
          description: The showing ID to delete
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Showing deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

  /v1/webhooks:
    get:
      operationId: listWebhooks
      summary: List webhook subscriptions
      description: |
        Returns all webhook subscriptions for your team.
      tags:
        - Webhooks
      responses:
        '200':
          description: Successfully retrieved webhooks
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhooksListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

    post:
      operationId: createWebhook
      summary: Create a webhook subscription
      description: |
        Creates a new webhook subscription. The webhook secret is only returned once at creation time.
        Use the secret to verify webhook signatures.
      tags:
        - Webhooks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateWebhookRequest'
            example:
              url: "https://hooks.zapier.com/hooks/catch/12345/abcdef/"
              events: ["report.created", "showing.created"]
              description: "Zapier automation"
      responses:
        '201':
          description: Webhook created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateWebhookResponse'
              example:
                message: "Webhook created successfully"
                data:
                  id: "550e8400-e29b-41d4-a716-446655440000"
                  url: "https://hooks.zapier.com/hooks/catch/12345/abcdef/"
                  events: ["report.created", "showing.created"]
                  is_active: true
                  description: "Zapier automation"
                  created_at: "2024-01-15T10:30:00Z"
                  secret: "whsec_abc123def456..."
                warning: "Save your webhook secret! It will not be shown again."
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

  /v1/webhooks/{webhookId}:
    get:
      operationId: getWebhook
      summary: Get a specific webhook
      description: |
        Retrieves details for a single webhook subscription.
      tags:
        - Webhooks
      parameters:
        - name: webhookId
          in: path
          required: true
          description: The webhook ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Successfully retrieved webhook
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Webhook'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

    patch:
      operationId: updateWebhook
      summary: Update a webhook
      description: |
        Updates a webhook subscription. Only provided fields will be updated.
      tags:
        - Webhooks
      parameters:
        - name: webhookId
          in: path
          required: true
          description: The webhook ID to update
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateWebhookRequest'
      responses:
        '200':
          description: Webhook updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdateWebhookResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

    delete:
      operationId: deleteWebhook
      summary: Delete a webhook
      description: |
        Permanently deletes a webhook subscription. You will no longer receive events for this webhook.
      tags:
        - Webhooks
      parameters:
        - name: webhookId
          in: path
          required: true
          description: The webhook ID to delete
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Webhook deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      description: |
        API key authentication. Include your API key in the Authorization header:
        ```
        Authorization: Bearer north_sk_live_xxxxxxxxxxxx
        ```

  schemas:
    UserResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            team:
              type: object
              properties:
                id:
                  type: string
                  format: uuid
                name:
                  type: string
                created_at:
                  type: string
                  format: date-time
                member_count:
                  type: integer
                reports_count:
                  type: integer
            subscription:
              type: object
              properties:
                plan:
                  type: string
                status:
                  type: string
                api_usage:
                  type: object
                  properties:
                    calls_this_month:
                      type: integer
                    resets_at:
                      type: string
                      format: date-time
            api_key:
              type: object
              properties:
                name:
                  type: string
                  description: Name of the API key being used
                prefix:
                  type: string
                  description: First characters of the API key for identification

    ReportsListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/ReportSummary'
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer

    ReportSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
        address:
          type: string
        city:
          type: string
        state:
          type: string
        zip:
          type: string
        price:
          type: number
        bedrooms:
          type: integer
          description: Number of bedrooms
        bathrooms:
          type: number
          description: Number of bathrooms
        square_feet:
          type: integer
          description: Total square footage
        year_built:
          type: integer
        property_type:
          type: string
        status:
          type: string
        is_published:
          type: boolean
        is_draft:
          type: boolean
        published_at:
          type: string
          format: date-time
          nullable: true
        views_count:
          type: integer
        saves_count:
          type: integer
        showings_count:
          type: integer
        date_created:
          type: string
          format: date-time
          description: When the report was created
        updated_at:
          type: string
          format: date-time

    CreateReportRequest:
      type: object
      required:
        - address
      properties:
        address:
          type: string
          description: Property street address
        city:
          type: string
        state:
          type: string
        zip:
          type: string
        price:
          type: number
          description: Listing price in dollars
        bedrooms:
          type: integer
          description: Number of bedrooms (also accepts "beds")
        bathrooms:
          type: number
          description: Number of bathrooms (also accepts "baths")
        square_feet:
          type: integer
          description: Total square footage (also accepts "sqft")
        year_built:
          type: integer
        property_type:
          type: string
          description: e.g., "Single Family", "Condo", "Townhouse"
        lot_size:
          type: string
        description:
          type: string
        zpid:
          type: string
          description: Zillow property ID
        zillow_url:
          type: string
          format: uri
        mls_id:
          type: string
        status:
          type: string
          default: "For Sale"
        is_draft:
          type: boolean
          default: true
        custom_agent_name:
          type: string
        custom_logo_url:
          type: string
          format: uri
        primary_brand_color:
          type: string
          description: Hex color code
        secondary_brand_color:
          type: string
          description: Hex color code

    CreateReportResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            id:
              type: string
              format: uuid
            address:
              type: string
            city:
              type: string
            state:
              type: string
            zip:
              type: string
            price:
              type: number
            bedrooms:
              type: integer
            bathrooms:
              type: number
            square_feet:
              type: integer
            date_created:
              type: string
              format: date-time
        message:
          type: string

    UpdateReportRequest:
      type: object
      properties:
        address:
          type: string
        city:
          type: string
        state:
          type: string
        zip:
          type: string
        price:
          type: number
        bedrooms:
          type: integer
          description: Number of bedrooms (also accepts "beds")
        bathrooms:
          type: number
          description: Number of bathrooms (also accepts "baths")
        square_feet:
          type: integer
          description: Total square footage (also accepts "sqft")
        year_built:
          type: integer
        property_type:
          type: string
        description:
          type: string
        status:
          type: string
        is_draft:
          type: boolean
        executive_summary:
          type: string
        show_comps_on_report:
          type: boolean
        show_neighborhood_on_report:
          type: boolean
        show_social_on_report:
          type: boolean
        show_showings_on_report:
          type: boolean
        show_agent_insights_on_report:
          type: boolean

    UpdateReportResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            id:
              type: string
              format: uuid
            address:
              type: string
            city:
              type: string
            state:
              type: string
            updated_at:
              type: string
              format: date-time
        message:
          type: string

    ShowingsListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Showing'
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer

    Showing:
      type: object
      properties:
        id:
          type: string
          format: uuid
        report_id:
          type: string
          format: uuid
        showing_date:
          type: string
          format: date-time
        attendee_name:
          type: string
          nullable: true
        attendee_email:
          type: string
          nullable: true
        attendee_phone:
          type: string
          nullable: true
        agent_name:
          type: string
          nullable: true
        feedback:
          type: string
          nullable: true
        rating:
          type: integer
          minimum: 1
          maximum: 5
          nullable: true
        interested:
          type: boolean
          nullable: true
        event_type:
          type: string
          enum: [showing, open_house]
        title:
          type: string
          nullable: true
        attendees_count:
          type: integer
        created_at:
          type: string
          format: date-time

    CreateShowingRequest:
      type: object
      required:
        - report_id
      properties:
        report_id:
          type: string
          format: uuid
          description: The report this showing belongs to
        showing_date:
          type: string
          format: date-time
          description: Date and time of the showing
        attendee_name:
          type: string
        attendee_email:
          type: string
        attendee_phone:
          type: string
        agent_name:
          type: string
        feedback:
          type: string
        rating:
          type: integer
          minimum: 1
          maximum: 5
        interested:
          type: boolean
        event_type:
          type: string
          enum: [showing, open_house]
          default: showing
        title:
          type: string
        attendees_count:
          type: integer
          default: 1

    CreateShowingResponse:
      type: object
      properties:
        message:
          type: string
        data:
          $ref: '#/components/schemas/Showing'

    UpdateShowingRequest:
      type: object
      properties:
        showing_date:
          type: string
          format: date-time
        attendee_name:
          type: string
        attendee_email:
          type: string
        attendee_phone:
          type: string
        agent_name:
          type: string
        feedback:
          type: string
        rating:
          type: integer
          minimum: 1
          maximum: 5
        interested:
          type: boolean
        event_type:
          type: string
          enum: [showing, open_house]
        title:
          type: string
        attendees_count:
          type: integer

    UpdateShowingResponse:
      type: object
      properties:
        message:
          type: string
        data:
          $ref: '#/components/schemas/Showing'

    WebhooksListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Webhook'

    Webhook:
      type: object
      properties:
        id:
          type: string
          format: uuid
        url:
          type: string
          format: uri
        events:
          type: array
          items:
            type: string
            enum:
              - report.created
              - report.updated
              - report.published
              - report.deleted
              - showing.created
              - showing.updated
              - showing.deleted
              - comp.added
              - comp.removed
        is_active:
          type: boolean
        description:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        last_triggered_at:
          type: string
          format: date-time
          nullable: true
        failure_count:
          type: integer

    CreateWebhookRequest:
      type: object
      required:
        - url
        - events
      properties:
        url:
          type: string
          format: uri
          description: The URL to send webhook events to (e.g., Zapier, Make.com, n8n)
        events:
          type: array
          items:
            type: string
            enum:
              - report.created
              - report.updated
              - report.published
              - report.deleted
              - showing.created
              - showing.updated
              - showing.deleted
              - comp.added
              - comp.removed
          description: List of event types to subscribe to
        description:
          type: string
          description: Optional description for this webhook

    CreateWebhookResponse:
      type: object
      properties:
        message:
          type: string
        data:
          allOf:
            - $ref: '#/components/schemas/Webhook'
            - type: object
              properties:
                secret:
                  type: string
                  description: Webhook secret for signature verification (only shown once)
        warning:
          type: string

    UpdateWebhookRequest:
      type: object
      properties:
        url:
          type: string
          format: uri
        events:
          type: array
          items:
            type: string
        is_active:
          type: boolean
        description:
          type: string

    UpdateWebhookResponse:
      type: object
      properties:
        message:
          type: string
        data:
          $ref: '#/components/schemas/Webhook'

    DeleteResponse:
      type: object
      properties:
        message:
          type: string

    Error:
      type: object
      properties:
        error:
          type: object
          properties:
            message:
              type: string
            status:
              type: integer

  responses:
    BadRequest:
      description: Invalid request parameters
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              message: "Address is required"
              status: 400

    Unauthorized:
      description: Invalid or missing API key
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              message: "Invalid API key"
              status: 401

    Forbidden:
      description: API key lacks required permission
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              message: "Permission denied: reports:create"
              status: 403

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              message: "Report not found"
              status: 404

    RateLimitExceeded:
      description: Too many requests
      headers:
        X-RateLimit-Limit:
          schema:
            type: integer
          description: Request limit per hour
        X-RateLimit-Remaining:
          schema:
            type: integer
          description: Remaining requests in current window
        X-RateLimit-Reset:
          schema:
            type: integer
          description: Unix timestamp when the rate limit resets
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              message: "Rate limit exceeded. Please try again later."
              status: 429
